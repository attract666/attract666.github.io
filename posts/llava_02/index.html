<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>从零开始学LLaVA 02 | JiaHe&#39;s Blog</title>
<meta name="keywords" content="vision-language-models, LLaVA">
<meta name="description" content="LLaVA-1.5悟道

LLaVA-NEXT
与LLaVA-1.5相比，主要有以下提升：

将输入图像分辨率提高 4 倍，使得它能够捕捉更多的视觉细节。它支持 3 种不同比例的分辨率，分别是 672x672、336x1344、1344x336。
改变视觉指令微调数据的比例，实现更好的视觉推理和 OCR 能力
更好的视觉对话，适用于更多场景，涵盖不同应用。
使用 SGLang 实现高效部署和推理。


构造多模态数据
常言道：“工欲善其事，必先利其器。”LLaVA这篇论文的另一个核心贡献就是在于将图像文本对转换成了多模态instruction-following数据。LLaVA构造了三种多模态instruction-following数据：

对话（Conversation）
细节描述（Detailed description）
复杂推理（Complex reasoning）

Conversation构造
构造的思路如下：

给出一个system prompt，要求纯文本大模型根据图片的描述生成多轮对话
提供几个示例，便于纯文本大模型理解以及生成类似的多轮对话
将上面的内容输入给纯文本大模型，纯文本大模型返回多轮对话

system prompt和示例的内容可以见LLaVA/playground/data/prompts，在LLaVA论文中也给出了构造数据的示例代码：

Sample Codes.(Image source:LLaVA)
我这里由于没有gpt4的api，所以决定用llama3来代替，使用了vllm框架
具体的代码实现如下：
# 先启动服务
# python3 -m vllm.entrypoints.openai.api_server --model ./Meta-Llama-3-8B-Instruct --dtype auto --api-key 123456
from openai import OpenAI

openai_api_key = &#34;123456&#34;  # Same as --api-key in the deployment command
openai_api_base = &#34;http://localhost:8000/v1&#34;
client = OpenAI(api_key=openai_api_key, base_url=openai_api_base)
model = &#39;./Meta-Llama-3-8B-Instruct&#39;

SYSTEM_CONTENT = &#34;&#34;&#34;
You are an AI visual assistant, and you are seeing a single image. What you see are provided with five sentences, describing the same image you are looking at. Answer all questions as you are seeing the image.

Design a conversation between you and a person asking about this photo. The answers should be in a tone that a visual AI assistant is seeing the image and answering the question.
Ask diverse questions and give corresponding answers.

Include questions asking about the visual content of the image, including the object types, counting the objects, object actions, object locations, relative positions between objects, etc. Only include questions that have definite answers:
(1) one can see the content in the image that the question asks about and can answer confidently;
(2) one can determine confidently from the image that it is not in the image.
Do not ask any question that cannot be answered confidently.

Also include complex questions that are relevant to the content in the image, for example, asking about background knowledge of the objects in the image, asking to discuss about events happening in the image, etc. Again, do not ask about uncertain details.
Provide detailed answers when answering complex questions. For example, give detailed examples or reasoning steps to make the content more convincing and well-organized.  You can include multiple paragraphs if necessary.
&#34;&#34;&#34;

SAMPLE_CONTENT_1 = &#34;&#34;&#34;
There is a movie theater that displays the show times above the doors.
A red fire hydrant is deep in the snow.
The fire hydrant is in the snow near a recently plowed sidewalk.
This city has had a very hard winter with snow.
A hotel for dogs in the snow in winter.&#34;&#34;&#34;

SAMPLE_RESPONSE_1 = &#34;&#34;&#34;
Question:
What color is the fire hydrant in the image?
===
Answer:
The fire hydrant in the image is red.
===
Question:
Is the fire hydrant fully covered by snow or partially visible?
===
Answer:
The fire hydrant is partially visible, with a significant portion of it covered by the deep snow.
===
Question:
What is the condition of the sidewalk near the fire hydrant?
===
Answer:
The sidewalk near the fire hydrant has been recently plowed, so it is relatively clear of snow compared to the surrounding area.
===
Question:
What does the image suggest about the winter season in the city?
===
Answer:
The image suggests that the winter season in the city has been quite harsh and challenging. The significant snow accumulation seen in the image indicates that the city has experienced heavy snowfall, which can lead to various difficulties and disruptions for its residents. 

For instance, the deep snow covering the fire hydrant could potentially hinder its accessibility in case of emergencies, which poses safety concerns. The recently plowed sidewalk implies that the city&#39;s maintenance crews have been actively working to keep the walkways clear and safe for pedestrians, but the sheer amount of snowfall might make it difficult to keep up with the continuous snow removal efforts. 

Furthermore, such extreme winter conditions can impact transportation, leading to traffic issues, delays in public transit, and increased risks of accidents due to slippery roads. It can also cause problems for businesses and schools, as people might face challenges commuting to work or attending classes. Additionally, the heavy snow can put extra strain on infrastructure, such as roofs and power lines, increasing the likelihood of structural damage or power outages. 

In conclusion, the image of the red fire hydrant deep in the snow and the recently plowed sidewalk suggest that the city has faced a particularly severe winter season, with substantial snowfall that has likely caused various challenges and disruptions for its residents and infrastructure.
&#34;&#34;&#34;

SAMPLE_CONTENT_2 = &#34;&#34;&#34;
A man is skiing in the open snow covered hills
A skier is making his way into the snow.
A skier on the foothills of a huge mountain range.
A skier looks at mountains while standing near a trail sign.
a single person skiing by an area with a lot of bushes
&#34;&#34;&#34;

SAMPLE_RESPONSE_2 = &#34;&#34;&#34;
Question:
What is the skier doing?
===
Answer:
The skier is skiing in the snow-covered hills, making his way through the snow and enjoying the beautiful mountain scenery. They are also standing near a trail sign, which indicates their location on the mountain.
===
Question:
Are there any other people or skiers visible in the image?
===
Answer:
No, there is only a single person skiing in the image, and they are surrounded by an area with a lot of bushes.
===
Question:
What kind of skiing is the person doing? Cross-country or downhill?
===
Answer:
Based on what I can see in the photo, it is not possible to definitively determine whether the skier is doing cross-country or downhill skiing. However, given the presence of a trail sign and the fact that they are skiing in the foothills, it is more likely that the skier is engaged in cross-country skiing. Downhill skiing typically takes place on more steep slopes and involves ski lifts, whereas cross-country skiing often occurs on relatively flatter terrain with marked trails.
===
Question:
Can you explain cross-country and downhill skiing a bit more?
===
Answer:
Cross-country skiing and downhill skiing are two distinct types of skiing, each with its own techniques, equipment, and terrain preferences. 

1. Cross-Country Skiing:
Also known as Nordic skiing, cross-country skiing involves traversing relatively flat terrain or gentle slopes using skis and poles. It is a popular recreational and competitive sport that focuses on endurance, balance, and aerobic fitness. Cross-country skiers use their own locomotion to move across snow-covered terrain, rather than relying on ski lifts or other forms of assistance. 
There are two main techniques in cross-country skiing:
- Classic: This technique involves skiing in parallel tracks, using a forward-and-backward gliding motion while keeping the skis parallel to each other. The skier uses their poles to propel themselves forward.
- Skate skiing: This technique is similar to ice skating, where the skier pushes off one ski at an angle and glides on the other. It requires a smooth, groomed surface and is typically faster than the classic technique. 
Cross-country ski equipment consists of lightweight skis, boots, bindings, and poles. The boots are more flexible than those used in downhill skiing, allowing for better ankle movement and control. 

2. Downhill Skiing:
Also known as alpine skiing, downhill skiing involves descending slopes at high speeds using skis and poles for balance and control. This sport is more focused on speed, technique, and navigating challenging terrain, including steep slopes, moguls, and even jumps. 
Downhill skiing can be further categorized into several disciplines, such as slalom, giant slalom, super-G, and downhill racing. Each discipline has its own set of rules, courses, and ski equipment. 
Downhill ski equipment includes heavier and stiffer skis, boots, bindings, and poles than those used in cross-country skiing. The boots are more rigid to provide better support and control during high-speed descents and sharp turns. 

In summary, cross-country skiing is an endurance-based sport that involves traveling across flat or gently sloping terrain, while downhill skiing is focused on speed and technique as skiers navigate steeper slopes and challenging terrain. Both sports require specialized equipment and techniques, but they offer different experiences and challenges to participants.
&#34;&#34;&#34;

messages = [
    {
        &#39;role&#39;: &#39;system&#39;,
        &#39;content&#39;: SYSTEM_CONTENT,
    }
]

fewshot_samples = [
    {
        &#39;context&#39;: SAMPLE_CONTENT_1,
        &#39;response&#39;: SAMPLE_RESPONSE_1,
    },
    {
        &#39;context&#39;: SAMPLE_CONTENT_2,
        &#39;response&#39;: SAMPLE_RESPONSE_2,
    }
]

for sample in fewshot_samples:
    messages.append({&#39;role&#39;: &#39;user&#39;, &#39;content&#39;: sample[&#39;context&#39;]})
    messages.append({&#39;role&#39;: &#39;assistant&#39;, &#39;content&#39;: sample[&#39;response&#39;]})

query = &#34;&#34;&#34;
A group of people standing outside of a black vehicle with various luggage.
Luggage surrounds a vehicle in an underground parking area
People try to fit all of their luggage in an SUV.
The sport utility vehicle is parked in the public garage, being packed for a trip
Some people with luggage near a van that is transporting it.
&#34;&#34;&#34;
messages.append({&#34;role&#34;:&#34;user&#34;, &#34;content&#34;: query})

response = client.chat.completions.create(model=model, messages=messages).choices[0].message.content

print(response)
">
<meta name="author" content="">
<link rel="canonical" href="https://attract666.github.io/posts/llava_02/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://attract666.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://attract666.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://attract666.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://attract666.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://attract666.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://attract666.github.io/posts/llava_02/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="text/javascript" async
    src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\[\[', '\]\]']],
                processEscapes: true,
                processEnvironments: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                TeX: {
                    equationNumbers: { autoNumber: "AMS" },
                    extensions: ["AMSmath.js", "AMSsymbols.js"]
                }
            },
            "HTML-CSS": {
                availableFonts: ["Arial", "TeX"],
                preferredFont: "TeX",
                webFont: "TeX"
            }
        });

        MathJax.Hub.Queue(function () {
            
            
            
            var all = MathJax.Hub.getAllJax(), i;
            for (i = 0; i < all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>

<meta property="og:title" content="从零开始学LLaVA 02" />
<meta property="og:description" content="LLaVA-1.5悟道

LLaVA-NEXT
与LLaVA-1.5相比，主要有以下提升：

将输入图像分辨率提高 4 倍，使得它能够捕捉更多的视觉细节。它支持 3 种不同比例的分辨率，分别是 672x672、336x1344、1344x336。
改变视觉指令微调数据的比例，实现更好的视觉推理和 OCR 能力
更好的视觉对话，适用于更多场景，涵盖不同应用。
使用 SGLang 实现高效部署和推理。


构造多模态数据
常言道：“工欲善其事，必先利其器。”LLaVA这篇论文的另一个核心贡献就是在于将图像文本对转换成了多模态instruction-following数据。LLaVA构造了三种多模态instruction-following数据：

对话（Conversation）
细节描述（Detailed description）
复杂推理（Complex reasoning）

Conversation构造
构造的思路如下：

给出一个system prompt，要求纯文本大模型根据图片的描述生成多轮对话
提供几个示例，便于纯文本大模型理解以及生成类似的多轮对话
将上面的内容输入给纯文本大模型，纯文本大模型返回多轮对话

system prompt和示例的内容可以见LLaVA/playground/data/prompts，在LLaVA论文中也给出了构造数据的示例代码：

Sample Codes.(Image source:LLaVA)
我这里由于没有gpt4的api，所以决定用llama3来代替，使用了vllm框架
具体的代码实现如下：
# 先启动服务
# python3 -m vllm.entrypoints.openai.api_server --model ./Meta-Llama-3-8B-Instruct --dtype auto --api-key 123456
from openai import OpenAI

openai_api_key = &#34;123456&#34;  # Same as --api-key in the deployment command
openai_api_base = &#34;http://localhost:8000/v1&#34;
client = OpenAI(api_key=openai_api_key, base_url=openai_api_base)
model = &#39;./Meta-Llama-3-8B-Instruct&#39;

SYSTEM_CONTENT = &#34;&#34;&#34;
You are an AI visual assistant, and you are seeing a single image. What you see are provided with five sentences, describing the same image you are looking at. Answer all questions as you are seeing the image.

Design a conversation between you and a person asking about this photo. The answers should be in a tone that a visual AI assistant is seeing the image and answering the question.
Ask diverse questions and give corresponding answers.

Include questions asking about the visual content of the image, including the object types, counting the objects, object actions, object locations, relative positions between objects, etc. Only include questions that have definite answers:
(1) one can see the content in the image that the question asks about and can answer confidently;
(2) one can determine confidently from the image that it is not in the image.
Do not ask any question that cannot be answered confidently.

Also include complex questions that are relevant to the content in the image, for example, asking about background knowledge of the objects in the image, asking to discuss about events happening in the image, etc. Again, do not ask about uncertain details.
Provide detailed answers when answering complex questions. For example, give detailed examples or reasoning steps to make the content more convincing and well-organized.  You can include multiple paragraphs if necessary.
&#34;&#34;&#34;

SAMPLE_CONTENT_1 = &#34;&#34;&#34;
There is a movie theater that displays the show times above the doors.
A red fire hydrant is deep in the snow.
The fire hydrant is in the snow near a recently plowed sidewalk.
This city has had a very hard winter with snow.
A hotel for dogs in the snow in winter.&#34;&#34;&#34;

SAMPLE_RESPONSE_1 = &#34;&#34;&#34;
Question:
What color is the fire hydrant in the image?
===
Answer:
The fire hydrant in the image is red.
===
Question:
Is the fire hydrant fully covered by snow or partially visible?
===
Answer:
The fire hydrant is partially visible, with a significant portion of it covered by the deep snow.
===
Question:
What is the condition of the sidewalk near the fire hydrant?
===
Answer:
The sidewalk near the fire hydrant has been recently plowed, so it is relatively clear of snow compared to the surrounding area.
===
Question:
What does the image suggest about the winter season in the city?
===
Answer:
The image suggests that the winter season in the city has been quite harsh and challenging. The significant snow accumulation seen in the image indicates that the city has experienced heavy snowfall, which can lead to various difficulties and disruptions for its residents. 

For instance, the deep snow covering the fire hydrant could potentially hinder its accessibility in case of emergencies, which poses safety concerns. The recently plowed sidewalk implies that the city&#39;s maintenance crews have been actively working to keep the walkways clear and safe for pedestrians, but the sheer amount of snowfall might make it difficult to keep up with the continuous snow removal efforts. 

Furthermore, such extreme winter conditions can impact transportation, leading to traffic issues, delays in public transit, and increased risks of accidents due to slippery roads. It can also cause problems for businesses and schools, as people might face challenges commuting to work or attending classes. Additionally, the heavy snow can put extra strain on infrastructure, such as roofs and power lines, increasing the likelihood of structural damage or power outages. 

In conclusion, the image of the red fire hydrant deep in the snow and the recently plowed sidewalk suggest that the city has faced a particularly severe winter season, with substantial snowfall that has likely caused various challenges and disruptions for its residents and infrastructure.
&#34;&#34;&#34;

SAMPLE_CONTENT_2 = &#34;&#34;&#34;
A man is skiing in the open snow covered hills
A skier is making his way into the snow.
A skier on the foothills of a huge mountain range.
A skier looks at mountains while standing near a trail sign.
a single person skiing by an area with a lot of bushes
&#34;&#34;&#34;

SAMPLE_RESPONSE_2 = &#34;&#34;&#34;
Question:
What is the skier doing?
===
Answer:
The skier is skiing in the snow-covered hills, making his way through the snow and enjoying the beautiful mountain scenery. They are also standing near a trail sign, which indicates their location on the mountain.
===
Question:
Are there any other people or skiers visible in the image?
===
Answer:
No, there is only a single person skiing in the image, and they are surrounded by an area with a lot of bushes.
===
Question:
What kind of skiing is the person doing? Cross-country or downhill?
===
Answer:
Based on what I can see in the photo, it is not possible to definitively determine whether the skier is doing cross-country or downhill skiing. However, given the presence of a trail sign and the fact that they are skiing in the foothills, it is more likely that the skier is engaged in cross-country skiing. Downhill skiing typically takes place on more steep slopes and involves ski lifts, whereas cross-country skiing often occurs on relatively flatter terrain with marked trails.
===
Question:
Can you explain cross-country and downhill skiing a bit more?
===
Answer:
Cross-country skiing and downhill skiing are two distinct types of skiing, each with its own techniques, equipment, and terrain preferences. 

1. Cross-Country Skiing:
Also known as Nordic skiing, cross-country skiing involves traversing relatively flat terrain or gentle slopes using skis and poles. It is a popular recreational and competitive sport that focuses on endurance, balance, and aerobic fitness. Cross-country skiers use their own locomotion to move across snow-covered terrain, rather than relying on ski lifts or other forms of assistance. 
There are two main techniques in cross-country skiing:
- Classic: This technique involves skiing in parallel tracks, using a forward-and-backward gliding motion while keeping the skis parallel to each other. The skier uses their poles to propel themselves forward.
- Skate skiing: This technique is similar to ice skating, where the skier pushes off one ski at an angle and glides on the other. It requires a smooth, groomed surface and is typically faster than the classic technique. 
Cross-country ski equipment consists of lightweight skis, boots, bindings, and poles. The boots are more flexible than those used in downhill skiing, allowing for better ankle movement and control. 

2. Downhill Skiing:
Also known as alpine skiing, downhill skiing involves descending slopes at high speeds using skis and poles for balance and control. This sport is more focused on speed, technique, and navigating challenging terrain, including steep slopes, moguls, and even jumps. 
Downhill skiing can be further categorized into several disciplines, such as slalom, giant slalom, super-G, and downhill racing. Each discipline has its own set of rules, courses, and ski equipment. 
Downhill ski equipment includes heavier and stiffer skis, boots, bindings, and poles than those used in cross-country skiing. The boots are more rigid to provide better support and control during high-speed descents and sharp turns. 

In summary, cross-country skiing is an endurance-based sport that involves traveling across flat or gently sloping terrain, while downhill skiing is focused on speed and technique as skiers navigate steeper slopes and challenging terrain. Both sports require specialized equipment and techniques, but they offer different experiences and challenges to participants.
&#34;&#34;&#34;

messages = [
    {
        &#39;role&#39;: &#39;system&#39;,
        &#39;content&#39;: SYSTEM_CONTENT,
    }
]

fewshot_samples = [
    {
        &#39;context&#39;: SAMPLE_CONTENT_1,
        &#39;response&#39;: SAMPLE_RESPONSE_1,
    },
    {
        &#39;context&#39;: SAMPLE_CONTENT_2,
        &#39;response&#39;: SAMPLE_RESPONSE_2,
    }
]

for sample in fewshot_samples:
    messages.append({&#39;role&#39;: &#39;user&#39;, &#39;content&#39;: sample[&#39;context&#39;]})
    messages.append({&#39;role&#39;: &#39;assistant&#39;, &#39;content&#39;: sample[&#39;response&#39;]})

query = &#34;&#34;&#34;
A group of people standing outside of a black vehicle with various luggage.
Luggage surrounds a vehicle in an underground parking area
People try to fit all of their luggage in an SUV.
The sport utility vehicle is parked in the public garage, being packed for a trip
Some people with luggage near a van that is transporting it.
&#34;&#34;&#34;
messages.append({&#34;role&#34;:&#34;user&#34;, &#34;content&#34;: query})

response = client.chat.completions.create(model=model, messages=messages).choices[0].message.content

print(response)
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://attract666.github.io/posts/llava_02/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-11-01T18:21:23+08:00" />
<meta property="article:modified_time" content="2024-11-01T18:21:23+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="从零开始学LLaVA 02"/>
<meta name="twitter:description" content="LLaVA-1.5悟道

LLaVA-NEXT
与LLaVA-1.5相比，主要有以下提升：

将输入图像分辨率提高 4 倍，使得它能够捕捉更多的视觉细节。它支持 3 种不同比例的分辨率，分别是 672x672、336x1344、1344x336。
改变视觉指令微调数据的比例，实现更好的视觉推理和 OCR 能力
更好的视觉对话，适用于更多场景，涵盖不同应用。
使用 SGLang 实现高效部署和推理。


构造多模态数据
常言道：“工欲善其事，必先利其器。”LLaVA这篇论文的另一个核心贡献就是在于将图像文本对转换成了多模态instruction-following数据。LLaVA构造了三种多模态instruction-following数据：

对话（Conversation）
细节描述（Detailed description）
复杂推理（Complex reasoning）

Conversation构造
构造的思路如下：

给出一个system prompt，要求纯文本大模型根据图片的描述生成多轮对话
提供几个示例，便于纯文本大模型理解以及生成类似的多轮对话
将上面的内容输入给纯文本大模型，纯文本大模型返回多轮对话

system prompt和示例的内容可以见LLaVA/playground/data/prompts，在LLaVA论文中也给出了构造数据的示例代码：

Sample Codes.(Image source:LLaVA)
我这里由于没有gpt4的api，所以决定用llama3来代替，使用了vllm框架
具体的代码实现如下：
# 先启动服务
# python3 -m vllm.entrypoints.openai.api_server --model ./Meta-Llama-3-8B-Instruct --dtype auto --api-key 123456
from openai import OpenAI

openai_api_key = &#34;123456&#34;  # Same as --api-key in the deployment command
openai_api_base = &#34;http://localhost:8000/v1&#34;
client = OpenAI(api_key=openai_api_key, base_url=openai_api_base)
model = &#39;./Meta-Llama-3-8B-Instruct&#39;

SYSTEM_CONTENT = &#34;&#34;&#34;
You are an AI visual assistant, and you are seeing a single image. What you see are provided with five sentences, describing the same image you are looking at. Answer all questions as you are seeing the image.

Design a conversation between you and a person asking about this photo. The answers should be in a tone that a visual AI assistant is seeing the image and answering the question.
Ask diverse questions and give corresponding answers.

Include questions asking about the visual content of the image, including the object types, counting the objects, object actions, object locations, relative positions between objects, etc. Only include questions that have definite answers:
(1) one can see the content in the image that the question asks about and can answer confidently;
(2) one can determine confidently from the image that it is not in the image.
Do not ask any question that cannot be answered confidently.

Also include complex questions that are relevant to the content in the image, for example, asking about background knowledge of the objects in the image, asking to discuss about events happening in the image, etc. Again, do not ask about uncertain details.
Provide detailed answers when answering complex questions. For example, give detailed examples or reasoning steps to make the content more convincing and well-organized.  You can include multiple paragraphs if necessary.
&#34;&#34;&#34;

SAMPLE_CONTENT_1 = &#34;&#34;&#34;
There is a movie theater that displays the show times above the doors.
A red fire hydrant is deep in the snow.
The fire hydrant is in the snow near a recently plowed sidewalk.
This city has had a very hard winter with snow.
A hotel for dogs in the snow in winter.&#34;&#34;&#34;

SAMPLE_RESPONSE_1 = &#34;&#34;&#34;
Question:
What color is the fire hydrant in the image?
===
Answer:
The fire hydrant in the image is red.
===
Question:
Is the fire hydrant fully covered by snow or partially visible?
===
Answer:
The fire hydrant is partially visible, with a significant portion of it covered by the deep snow.
===
Question:
What is the condition of the sidewalk near the fire hydrant?
===
Answer:
The sidewalk near the fire hydrant has been recently plowed, so it is relatively clear of snow compared to the surrounding area.
===
Question:
What does the image suggest about the winter season in the city?
===
Answer:
The image suggests that the winter season in the city has been quite harsh and challenging. The significant snow accumulation seen in the image indicates that the city has experienced heavy snowfall, which can lead to various difficulties and disruptions for its residents. 

For instance, the deep snow covering the fire hydrant could potentially hinder its accessibility in case of emergencies, which poses safety concerns. The recently plowed sidewalk implies that the city&#39;s maintenance crews have been actively working to keep the walkways clear and safe for pedestrians, but the sheer amount of snowfall might make it difficult to keep up with the continuous snow removal efforts. 

Furthermore, such extreme winter conditions can impact transportation, leading to traffic issues, delays in public transit, and increased risks of accidents due to slippery roads. It can also cause problems for businesses and schools, as people might face challenges commuting to work or attending classes. Additionally, the heavy snow can put extra strain on infrastructure, such as roofs and power lines, increasing the likelihood of structural damage or power outages. 

In conclusion, the image of the red fire hydrant deep in the snow and the recently plowed sidewalk suggest that the city has faced a particularly severe winter season, with substantial snowfall that has likely caused various challenges and disruptions for its residents and infrastructure.
&#34;&#34;&#34;

SAMPLE_CONTENT_2 = &#34;&#34;&#34;
A man is skiing in the open snow covered hills
A skier is making his way into the snow.
A skier on the foothills of a huge mountain range.
A skier looks at mountains while standing near a trail sign.
a single person skiing by an area with a lot of bushes
&#34;&#34;&#34;

SAMPLE_RESPONSE_2 = &#34;&#34;&#34;
Question:
What is the skier doing?
===
Answer:
The skier is skiing in the snow-covered hills, making his way through the snow and enjoying the beautiful mountain scenery. They are also standing near a trail sign, which indicates their location on the mountain.
===
Question:
Are there any other people or skiers visible in the image?
===
Answer:
No, there is only a single person skiing in the image, and they are surrounded by an area with a lot of bushes.
===
Question:
What kind of skiing is the person doing? Cross-country or downhill?
===
Answer:
Based on what I can see in the photo, it is not possible to definitively determine whether the skier is doing cross-country or downhill skiing. However, given the presence of a trail sign and the fact that they are skiing in the foothills, it is more likely that the skier is engaged in cross-country skiing. Downhill skiing typically takes place on more steep slopes and involves ski lifts, whereas cross-country skiing often occurs on relatively flatter terrain with marked trails.
===
Question:
Can you explain cross-country and downhill skiing a bit more?
===
Answer:
Cross-country skiing and downhill skiing are two distinct types of skiing, each with its own techniques, equipment, and terrain preferences. 

1. Cross-Country Skiing:
Also known as Nordic skiing, cross-country skiing involves traversing relatively flat terrain or gentle slopes using skis and poles. It is a popular recreational and competitive sport that focuses on endurance, balance, and aerobic fitness. Cross-country skiers use their own locomotion to move across snow-covered terrain, rather than relying on ski lifts or other forms of assistance. 
There are two main techniques in cross-country skiing:
- Classic: This technique involves skiing in parallel tracks, using a forward-and-backward gliding motion while keeping the skis parallel to each other. The skier uses their poles to propel themselves forward.
- Skate skiing: This technique is similar to ice skating, where the skier pushes off one ski at an angle and glides on the other. It requires a smooth, groomed surface and is typically faster than the classic technique. 
Cross-country ski equipment consists of lightweight skis, boots, bindings, and poles. The boots are more flexible than those used in downhill skiing, allowing for better ankle movement and control. 

2. Downhill Skiing:
Also known as alpine skiing, downhill skiing involves descending slopes at high speeds using skis and poles for balance and control. This sport is more focused on speed, technique, and navigating challenging terrain, including steep slopes, moguls, and even jumps. 
Downhill skiing can be further categorized into several disciplines, such as slalom, giant slalom, super-G, and downhill racing. Each discipline has its own set of rules, courses, and ski equipment. 
Downhill ski equipment includes heavier and stiffer skis, boots, bindings, and poles than those used in cross-country skiing. The boots are more rigid to provide better support and control during high-speed descents and sharp turns. 

In summary, cross-country skiing is an endurance-based sport that involves traveling across flat or gently sloping terrain, while downhill skiing is focused on speed and technique as skiers navigate steeper slopes and challenging terrain. Both sports require specialized equipment and techniques, but they offer different experiences and challenges to participants.
&#34;&#34;&#34;

messages = [
    {
        &#39;role&#39;: &#39;system&#39;,
        &#39;content&#39;: SYSTEM_CONTENT,
    }
]

fewshot_samples = [
    {
        &#39;context&#39;: SAMPLE_CONTENT_1,
        &#39;response&#39;: SAMPLE_RESPONSE_1,
    },
    {
        &#39;context&#39;: SAMPLE_CONTENT_2,
        &#39;response&#39;: SAMPLE_RESPONSE_2,
    }
]

for sample in fewshot_samples:
    messages.append({&#39;role&#39;: &#39;user&#39;, &#39;content&#39;: sample[&#39;context&#39;]})
    messages.append({&#39;role&#39;: &#39;assistant&#39;, &#39;content&#39;: sample[&#39;response&#39;]})

query = &#34;&#34;&#34;
A group of people standing outside of a black vehicle with various luggage.
Luggage surrounds a vehicle in an underground parking area
People try to fit all of their luggage in an SUV.
The sport utility vehicle is parked in the public garage, being packed for a trip
Some people with luggage near a van that is transporting it.
&#34;&#34;&#34;
messages.append({&#34;role&#34;:&#34;user&#34;, &#34;content&#34;: query})

response = client.chat.completions.create(model=model, messages=messages).choices[0].message.content

print(response)
"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://attract666.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "从零开始学LLaVA 02",
      "item": "https://attract666.github.io/posts/llava_02/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "从零开始学LLaVA 02",
  "name": "从零开始学LLaVA 02",
  "description": "LLaVA-1.5悟道 LLaVA-NEXT 与LLaVA-1.5相比，主要有以下提升：\n将输入图像分辨率提高 4 倍，使得它能够捕捉更多的视觉细节。它支持 3 种不同比例的分辨率，分别是 672x672、336x1344、1344x336。 改变视觉指令微调数据的比例，实现更好的视觉推理和 OCR 能力 更好的视觉对话，适用于更多场景，涵盖不同应用。 使用 SGLang 实现高效部署和推理。 构造多模态数据 常言道：“工欲善其事，必先利其器。”LLaVA这篇论文的另一个核心贡献就是在于将图像文本对转换成了多模态instruction-following数据。LLaVA构造了三种多模态instruction-following数据：\n对话（Conversation） 细节描述（Detailed description） 复杂推理（Complex reasoning） Conversation构造 构造的思路如下：\n给出一个system prompt，要求纯文本大模型根据图片的描述生成多轮对话 提供几个示例，便于纯文本大模型理解以及生成类似的多轮对话 将上面的内容输入给纯文本大模型，纯文本大模型返回多轮对话 system prompt和示例的内容可以见LLaVA/playground/data/prompts，在LLaVA论文中也给出了构造数据的示例代码：\nSample Codes.(Image source:LLaVA) 我这里由于没有gpt4的api，所以决定用llama3来代替，使用了vllm框架\n具体的代码实现如下：\n# 先启动服务 # python3 -m vllm.entrypoints.openai.api_server --model ./Meta-Llama-3-8B-Instruct --dtype auto --api-key 123456 from openai import OpenAI openai_api_key = \u0026#34;123456\u0026#34; # Same as --api-key in the deployment command openai_api_base = \u0026#34;http://localhost:8000/v1\u0026#34; client = OpenAI(api_key=openai_api_key, base_url=openai_api_base) model = \u0026#39;./Meta-Llama-3-8B-Instruct\u0026#39; SYSTEM_CONTENT = \u0026#34;\u0026#34;\u0026#34; You are an AI visual assistant, and you are seeing a single image. What you see are provided with five sentences, describing the same image you are looking at. Answer all questions as you are seeing the image. Design a conversation between you and a person asking about this photo. The answers should be in a tone that a visual AI assistant is seeing the image and answering the question. Ask diverse questions and give corresponding answers. Include questions asking about the visual content of the image, including the object types, counting the objects, object actions, object locations, relative positions between objects, etc. Only include questions that have definite answers: (1) one can see the content in the image that the question asks about and can answer confidently; (2) one can determine confidently from the image that it is not in the image. Do not ask any question that cannot be answered confidently. Also include complex questions that are relevant to the content in the image, for example, asking about background knowledge of the objects in the image, asking to discuss about events happening in the image, etc. Again, do not ask about uncertain details. Provide detailed answers when answering complex questions. For example, give detailed examples or reasoning steps to make the content more convincing and well-organized. You can include multiple paragraphs if necessary. \u0026#34;\u0026#34;\u0026#34; SAMPLE_CONTENT_1 = \u0026#34;\u0026#34;\u0026#34; There is a movie theater that displays the show times above the doors. A red fire hydrant is deep in the snow. The fire hydrant is in the snow near a recently plowed sidewalk. This city has had a very hard winter with snow. A hotel for dogs in the snow in winter.\u0026#34;\u0026#34;\u0026#34; SAMPLE_RESPONSE_1 = \u0026#34;\u0026#34;\u0026#34; Question: What color is the fire hydrant in the image? === Answer: The fire hydrant in the image is red. === Question: Is the fire hydrant fully covered by snow or partially visible? === Answer: The fire hydrant is partially visible, with a significant portion of it covered by the deep snow. === Question: What is the condition of the sidewalk near the fire hydrant? === Answer: The sidewalk near the fire hydrant has been recently plowed, so it is relatively clear of snow compared to the surrounding area. === Question: What does the image suggest about the winter season in the city? === Answer: The image suggests that the winter season in the city has been quite harsh and challenging. The significant snow accumulation seen in the image indicates that the city has experienced heavy snowfall, which can lead to various difficulties and disruptions for its residents. For instance, the deep snow covering the fire hydrant could potentially hinder its accessibility in case of emergencies, which poses safety concerns. The recently plowed sidewalk implies that the city\u0026#39;s maintenance crews have been actively working to keep the walkways clear and safe for pedestrians, but the sheer amount of snowfall might make it difficult to keep up with the continuous snow removal efforts. Furthermore, such extreme winter conditions can impact transportation, leading to traffic issues, delays in public transit, and increased risks of accidents due to slippery roads. It can also cause problems for businesses and schools, as people might face challenges commuting to work or attending classes. Additionally, the heavy snow can put extra strain on infrastructure, such as roofs and power lines, increasing the likelihood of structural damage or power outages. In conclusion, the image of the red fire hydrant deep in the snow and the recently plowed sidewalk suggest that the city has faced a particularly severe winter season, with substantial snowfall that has likely caused various challenges and disruptions for its residents and infrastructure. \u0026#34;\u0026#34;\u0026#34; SAMPLE_CONTENT_2 = \u0026#34;\u0026#34;\u0026#34; A man is skiing in the open snow covered hills A skier is making his way into the snow. A skier on the foothills of a huge mountain range. A skier looks at mountains while standing near a trail sign. a single person skiing by an area with a lot of bushes \u0026#34;\u0026#34;\u0026#34; SAMPLE_RESPONSE_2 = \u0026#34;\u0026#34;\u0026#34; Question: What is the skier doing? === Answer: The skier is skiing in the snow-covered hills, making his way through the snow and enjoying the beautiful mountain scenery. They are also standing near a trail sign, which indicates their location on the mountain. === Question: Are there any other people or skiers visible in the image? === Answer: No, there is only a single person skiing in the image, and they are surrounded by an area with a lot of bushes. === Question: What kind of skiing is the person doing? Cross-country or downhill? === Answer: Based on what I can see in the photo, it is not possible to definitively determine whether the skier is doing cross-country or downhill skiing. However, given the presence of a trail sign and the fact that they are skiing in the foothills, it is more likely that the skier is engaged in cross-country skiing. Downhill skiing typically takes place on more steep slopes and involves ski lifts, whereas cross-country skiing often occurs on relatively flatter terrain with marked trails. === Question: Can you explain cross-country and downhill skiing a bit more? === Answer: Cross-country skiing and downhill skiing are two distinct types of skiing, each with its own techniques, equipment, and terrain preferences. 1. Cross-Country Skiing: Also known as Nordic skiing, cross-country skiing involves traversing relatively flat terrain or gentle slopes using skis and poles. It is a popular recreational and competitive sport that focuses on endurance, balance, and aerobic fitness. Cross-country skiers use their own locomotion to move across snow-covered terrain, rather than relying on ski lifts or other forms of assistance. There are two main techniques in cross-country skiing: - Classic: This technique involves skiing in parallel tracks, using a forward-and-backward gliding motion while keeping the skis parallel to each other. The skier uses their poles to propel themselves forward. - Skate skiing: This technique is similar to ice skating, where the skier pushes off one ski at an angle and glides on the other. It requires a smooth, groomed surface and is typically faster than the classic technique. Cross-country ski equipment consists of lightweight skis, boots, bindings, and poles. The boots are more flexible than those used in downhill skiing, allowing for better ankle movement and control. 2. Downhill Skiing: Also known as alpine skiing, downhill skiing involves descending slopes at high speeds using skis and poles for balance and control. This sport is more focused on speed, technique, and navigating challenging terrain, including steep slopes, moguls, and even jumps. Downhill skiing can be further categorized into several disciplines, such as slalom, giant slalom, super-G, and downhill racing. Each discipline has its own set of rules, courses, and ski equipment. Downhill ski equipment includes heavier and stiffer skis, boots, bindings, and poles than those used in cross-country skiing. The boots are more rigid to provide better support and control during high-speed descents and sharp turns. In summary, cross-country skiing is an endurance-based sport that involves traveling across flat or gently sloping terrain, while downhill skiing is focused on speed and technique as skiers navigate steeper slopes and challenging terrain. Both sports require specialized equipment and techniques, but they offer different experiences and challenges to participants. \u0026#34;\u0026#34;\u0026#34; messages = [ { \u0026#39;role\u0026#39;: \u0026#39;system\u0026#39;, \u0026#39;content\u0026#39;: SYSTEM_CONTENT, } ] fewshot_samples = [ { \u0026#39;context\u0026#39;: SAMPLE_CONTENT_1, \u0026#39;response\u0026#39;: SAMPLE_RESPONSE_1, }, { \u0026#39;context\u0026#39;: SAMPLE_CONTENT_2, \u0026#39;response\u0026#39;: SAMPLE_RESPONSE_2, } ] for sample in fewshot_samples: messages.append({\u0026#39;role\u0026#39;: \u0026#39;user\u0026#39;, \u0026#39;content\u0026#39;: sample[\u0026#39;context\u0026#39;]}) messages.append({\u0026#39;role\u0026#39;: \u0026#39;assistant\u0026#39;, \u0026#39;content\u0026#39;: sample[\u0026#39;response\u0026#39;]}) query = \u0026#34;\u0026#34;\u0026#34; A group of people standing outside of a black vehicle with various luggage. Luggage surrounds a vehicle in an underground parking area People try to fit all of their luggage in an SUV. The sport utility vehicle is parked in the public garage, being packed for a trip Some people with luggage near a van that is transporting it. \u0026#34;\u0026#34;\u0026#34; messages.append({\u0026#34;role\u0026#34;:\u0026#34;user\u0026#34;, \u0026#34;content\u0026#34;: query}) response = client.chat.completions.create(model=model, messages=messages).choices[0].message.content print(response) ",
  "keywords": [
    "vision-language-models", "LLaVA"
  ],
  "articleBody": "LLaVA-1.5悟道 LLaVA-NEXT 与LLaVA-1.5相比，主要有以下提升：\n将输入图像分辨率提高 4 倍，使得它能够捕捉更多的视觉细节。它支持 3 种不同比例的分辨率，分别是 672x672、336x1344、1344x336。 改变视觉指令微调数据的比例，实现更好的视觉推理和 OCR 能力 更好的视觉对话，适用于更多场景，涵盖不同应用。 使用 SGLang 实现高效部署和推理。 构造多模态数据 常言道：“工欲善其事，必先利其器。”LLaVA这篇论文的另一个核心贡献就是在于将图像文本对转换成了多模态instruction-following数据。LLaVA构造了三种多模态instruction-following数据：\n对话（Conversation） 细节描述（Detailed description） 复杂推理（Complex reasoning） Conversation构造 构造的思路如下：\n给出一个system prompt，要求纯文本大模型根据图片的描述生成多轮对话 提供几个示例，便于纯文本大模型理解以及生成类似的多轮对话 将上面的内容输入给纯文本大模型，纯文本大模型返回多轮对话 system prompt和示例的内容可以见LLaVA/playground/data/prompts，在LLaVA论文中也给出了构造数据的示例代码：\nSample Codes.(Image source:LLaVA) 我这里由于没有gpt4的api，所以决定用llama3来代替，使用了vllm框架\n具体的代码实现如下：\n# 先启动服务 # python3 -m vllm.entrypoints.openai.api_server --model ./Meta-Llama-3-8B-Instruct --dtype auto --api-key 123456 from openai import OpenAI openai_api_key = \"123456\" # Same as --api-key in the deployment command openai_api_base = \"http://localhost:8000/v1\" client = OpenAI(api_key=openai_api_key, base_url=openai_api_base) model = './Meta-Llama-3-8B-Instruct' SYSTEM_CONTENT = \"\"\" You are an AI visual assistant, and you are seeing a single image. What you see are provided with five sentences, describing the same image you are looking at. Answer all questions as you are seeing the image. Design a conversation between you and a person asking about this photo. The answers should be in a tone that a visual AI assistant is seeing the image and answering the question. Ask diverse questions and give corresponding answers. Include questions asking about the visual content of the image, including the object types, counting the objects, object actions, object locations, relative positions between objects, etc. Only include questions that have definite answers: (1) one can see the content in the image that the question asks about and can answer confidently; (2) one can determine confidently from the image that it is not in the image. Do not ask any question that cannot be answered confidently. Also include complex questions that are relevant to the content in the image, for example, asking about background knowledge of the objects in the image, asking to discuss about events happening in the image, etc. Again, do not ask about uncertain details. Provide detailed answers when answering complex questions. For example, give detailed examples or reasoning steps to make the content more convincing and well-organized. You can include multiple paragraphs if necessary. \"\"\" SAMPLE_CONTENT_1 = \"\"\" There is a movie theater that displays the show times above the doors. A red fire hydrant is deep in the snow. The fire hydrant is in the snow near a recently plowed sidewalk. This city has had a very hard winter with snow. A hotel for dogs in the snow in winter.\"\"\" SAMPLE_RESPONSE_1 = \"\"\" Question: What color is the fire hydrant in the image? === Answer: The fire hydrant in the image is red. === Question: Is the fire hydrant fully covered by snow or partially visible? === Answer: The fire hydrant is partially visible, with a significant portion of it covered by the deep snow. === Question: What is the condition of the sidewalk near the fire hydrant? === Answer: The sidewalk near the fire hydrant has been recently plowed, so it is relatively clear of snow compared to the surrounding area. === Question: What does the image suggest about the winter season in the city? === Answer: The image suggests that the winter season in the city has been quite harsh and challenging. The significant snow accumulation seen in the image indicates that the city has experienced heavy snowfall, which can lead to various difficulties and disruptions for its residents. For instance, the deep snow covering the fire hydrant could potentially hinder its accessibility in case of emergencies, which poses safety concerns. The recently plowed sidewalk implies that the city's maintenance crews have been actively working to keep the walkways clear and safe for pedestrians, but the sheer amount of snowfall might make it difficult to keep up with the continuous snow removal efforts. Furthermore, such extreme winter conditions can impact transportation, leading to traffic issues, delays in public transit, and increased risks of accidents due to slippery roads. It can also cause problems for businesses and schools, as people might face challenges commuting to work or attending classes. Additionally, the heavy snow can put extra strain on infrastructure, such as roofs and power lines, increasing the likelihood of structural damage or power outages. In conclusion, the image of the red fire hydrant deep in the snow and the recently plowed sidewalk suggest that the city has faced a particularly severe winter season, with substantial snowfall that has likely caused various challenges and disruptions for its residents and infrastructure. \"\"\" SAMPLE_CONTENT_2 = \"\"\" A man is skiing in the open snow covered hills A skier is making his way into the snow. A skier on the foothills of a huge mountain range. A skier looks at mountains while standing near a trail sign. a single person skiing by an area with a lot of bushes \"\"\" SAMPLE_RESPONSE_2 = \"\"\" Question: What is the skier doing? === Answer: The skier is skiing in the snow-covered hills, making his way through the snow and enjoying the beautiful mountain scenery. They are also standing near a trail sign, which indicates their location on the mountain. === Question: Are there any other people or skiers visible in the image? === Answer: No, there is only a single person skiing in the image, and they are surrounded by an area with a lot of bushes. === Question: What kind of skiing is the person doing? Cross-country or downhill? === Answer: Based on what I can see in the photo, it is not possible to definitively determine whether the skier is doing cross-country or downhill skiing. However, given the presence of a trail sign and the fact that they are skiing in the foothills, it is more likely that the skier is engaged in cross-country skiing. Downhill skiing typically takes place on more steep slopes and involves ski lifts, whereas cross-country skiing often occurs on relatively flatter terrain with marked trails. === Question: Can you explain cross-country and downhill skiing a bit more? === Answer: Cross-country skiing and downhill skiing are two distinct types of skiing, each with its own techniques, equipment, and terrain preferences. 1. Cross-Country Skiing: Also known as Nordic skiing, cross-country skiing involves traversing relatively flat terrain or gentle slopes using skis and poles. It is a popular recreational and competitive sport that focuses on endurance, balance, and aerobic fitness. Cross-country skiers use their own locomotion to move across snow-covered terrain, rather than relying on ski lifts or other forms of assistance. There are two main techniques in cross-country skiing: - Classic: This technique involves skiing in parallel tracks, using a forward-and-backward gliding motion while keeping the skis parallel to each other. The skier uses their poles to propel themselves forward. - Skate skiing: This technique is similar to ice skating, where the skier pushes off one ski at an angle and glides on the other. It requires a smooth, groomed surface and is typically faster than the classic technique. Cross-country ski equipment consists of lightweight skis, boots, bindings, and poles. The boots are more flexible than those used in downhill skiing, allowing for better ankle movement and control. 2. Downhill Skiing: Also known as alpine skiing, downhill skiing involves descending slopes at high speeds using skis and poles for balance and control. This sport is more focused on speed, technique, and navigating challenging terrain, including steep slopes, moguls, and even jumps. Downhill skiing can be further categorized into several disciplines, such as slalom, giant slalom, super-G, and downhill racing. Each discipline has its own set of rules, courses, and ski equipment. Downhill ski equipment includes heavier and stiffer skis, boots, bindings, and poles than those used in cross-country skiing. The boots are more rigid to provide better support and control during high-speed descents and sharp turns. In summary, cross-country skiing is an endurance-based sport that involves traveling across flat or gently sloping terrain, while downhill skiing is focused on speed and technique as skiers navigate steeper slopes and challenging terrain. Both sports require specialized equipment and techniques, but they offer different experiences and challenges to participants. \"\"\" messages = [ { 'role': 'system', 'content': SYSTEM_CONTENT, } ] fewshot_samples = [ { 'context': SAMPLE_CONTENT_1, 'response': SAMPLE_RESPONSE_1, }, { 'context': SAMPLE_CONTENT_2, 'response': SAMPLE_RESPONSE_2, } ] for sample in fewshot_samples: messages.append({'role': 'user', 'content': sample['context']}) messages.append({'role': 'assistant', 'content': sample['response']}) query = \"\"\" A group of people standing outside of a black vehicle with various luggage. Luggage surrounds a vehicle in an underground parking area People try to fit all of their luggage in an SUV. The sport utility vehicle is parked in the public garage, being packed for a trip Some people with luggage near a van that is transporting it. \"\"\" messages.append({\"role\":\"user\", \"content\": query}) response = client.chat.completions.create(model=model, messages=messages).choices[0].message.content print(response) 使用Llama3-8B-Instruct生成的问答数据如下所示：\nQuestion: What type of vehicle is being packed with luggage? === Answer: The vehicles being packed with luggage are a black SUV (sport utility vehicle) and a van. === Question: Where is the luggage being packed into the vehicle(s)? === Answer: The luggage is being packed into the vehicles in an underground parking area, as well as in a public garage. === Question: How many people are trying to fit their luggage into the vehicle? === Answer: It appears that there is a group of people trying to fit their luggage into the SUV, but the exact number is not clear from the image. === Question: What is the purpose of the people packing their luggage into the vehicle(s)? === Answer: Based on the context of the image, it appears that the people are packing their luggage into the vehicles in preparation for a trip. The luggage and the vehicles suggest that they are likely going on a vacation or a long journey, and the underground parking area and public garage suggest that they are preparing to leave from a city or urban area. === Question: Can you explain the importance of underground parking and public garages in urban areas? === Answer: Yes, certainly! Underground parking and public garages play a crucial role in urban areas, especially in cities with limited street parking and high population density. These structures provide a convenient and secure way for residents and visitors to park their vehicles, reducing the need for on-street parking and minimizing the visual impact of parked cars on the urban landscape. Underground parking garages, in particular, offer a range of benefits, including: * Protection from the elements: Cars are shielded from inclement weather, reducing the risk of damage and making it easier to maintain the vehicles. * Security: Underground parking garages often have controlled access, surveillance cameras, and secure entry/exit points, providing a safer environment for parked vehicles and their occupants. * Convenience: Underground parking garages are often located near public transportation hubs, commercial centers, and residential areas, making it easier for people to park and access their destinations. * Urban planning: Underground parking garages can help to reduce the visual impact of parking on urban streets, freeing up surface areas for other uses and helping to create more pedestrian-friendly and aesthetically pleasing public spaces. In the context of the image, the underground parking area and public garage suggest that the people are preparing to leave from a city or urban area, and the presence of luggage and vehicles confirms that they are embarking on a trip. 处理数据 ",
  "wordCount" : "1822",
  "inLanguage": "zh",
  "datePublished": "2024-11-01T18:21:23+08:00",
  "dateModified": "2024-11-01T18:21:23+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://attract666.github.io/posts/llava_02/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "JiaHe's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://attract666.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://attract666.github.io/" accesskey="h" title="JiaHe&#39;s Blog (Alt + H)">JiaHe&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://attract666.github.io/posts/" title="All posts">
                    <span>All posts</span>
                </a>
            </li>
            <li>
                <a href="https://attract666.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://attract666.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://attract666.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://attract666.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      从零开始学LLaVA 02
    </h1>
    <div class="post-meta"><span title='2024-11-01 18:21:23 +0800 CST'>十一月 1, 2024</span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#llava-15%e6%82%9f%e9%81%93" aria-label="LLaVA-1.5悟道">LLaVA-1.5悟道</a></li>
                    <li>
                        <a href="#llava-next" aria-label="LLaVA-NEXT">LLaVA-NEXT</a></li>
                    <li>
                        <a href="#%e6%9e%84%e9%80%a0%e5%a4%9a%e6%a8%a1%e6%80%81%e6%95%b0%e6%8d%ae" aria-label="构造多模态数据">构造多模态数据</a><ul>
                            
                    <li>
                        <a href="#conversation%e6%9e%84%e9%80%a0" aria-label="Conversation构造">Conversation构造</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%a4%84%e7%90%86%e6%95%b0%e6%8d%ae" aria-label="处理数据">处理数据</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h1 id="llava-15悟道">LLaVA-1.5悟道<a hidden class="anchor" aria-hidden="true" href="#llava-15悟道">#</a></h1>
<hr>
<h1 id="llava-next">LLaVA-NEXT<a hidden class="anchor" aria-hidden="true" href="#llava-next">#</a></h1>
<p>与LLaVA-1.5相比，主要有以下提升：</p>
<ul>
<li>将输入图像分辨率提高 4 倍，使得它能够捕捉更多的视觉细节。它支持 3 种不同比例的分辨率，分别是 672x672、336x1344、1344x336。</li>
<li>改变视觉指令微调数据的比例，实现更好的视觉推理和 OCR 能力</li>
<li>更好的视觉对话，适用于更多场景，涵盖不同应用。</li>
<li>使用 SGLang 实现高效部署和推理。</li>
</ul>
<hr>
<h1 id="构造多模态数据">构造多模态数据<a hidden class="anchor" aria-hidden="true" href="#构造多模态数据">#</a></h1>
<p>常言道：“工欲善其事，必先利其器。”LLaVA这篇论文的另一个核心贡献就是在于将图像文本对转换成了多模态instruction-following数据。LLaVA构造了三种多模态instruction-following数据：</p>
<ul>
<li>对话（Conversation）</li>
<li>细节描述（Detailed description）</li>
<li>复杂推理（Complex reasoning）</li>
</ul>
<h2 id="conversation构造">Conversation构造<a hidden class="anchor" aria-hidden="true" href="#conversation构造">#</a></h2>
<p>构造的思路如下：</p>
<ul>
<li>给出一个system prompt，要求纯文本大模型根据图片的描述生成多轮对话</li>
<li>提供几个示例，便于纯文本大模型理解以及生成类似的多轮对话</li>
<li>将上面的内容输入给纯文本大模型，纯文本大模型返回多轮对话</li>
</ul>
<p>system prompt和示例的内容可以见<code>LLaVA/playground/data/prompts</code>，在LLaVA论文中也给出了构造数据的示例代码：</p>
<center><img src="/img/LLaVA_02/sample_codes.png" width="70%" title=""></center>
<center>Sample Codes.(Image source:<a href="https://arxiv.org/abs/2304.08485">LLaVA</a>)</center><br/>
<p>我这里由于没有gpt4的api，所以决定用llama3来代替，使用了vllm框架</p>
<p>具体的代码实现如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#2f1e2e;background-color:#e7e9db;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8d8687"># 先启动服务</span>
</span></span><span style="display:flex;"><span><span style="color:#8d8687"># python3 -m vllm.entrypoints.openai.api_server --model ./Meta-Llama-3-8B-Instruct --dtype auto --api-key 123456</span>
</span></span><span style="display:flex;"><span><span style="color:#5bc4bf">from</span> <span style="color:#fec418">openai</span> <span style="color:#5bc4bf">import</span> OpenAI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>openai_api_key <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#34;123456&#34;</span>  <span style="color:#8d8687"># Same as --api-key in the deployment command</span>
</span></span><span style="display:flex;"><span>openai_api_base <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#34;http://localhost:8000/v1&#34;</span>
</span></span><span style="display:flex;"><span>client <span style="color:#5bc4bf">=</span> OpenAI(api_key<span style="color:#5bc4bf">=</span>openai_api_key, base_url<span style="color:#5bc4bf">=</span>openai_api_base)
</span></span><span style="display:flex;"><span>model <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#39;./Meta-Llama-3-8B-Instruct&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SYSTEM_CONTENT <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">You are an AI visual assistant, and you are seeing a single image. What you see are provided with five sentences, describing the same image you are looking at. Answer all questions as you are seeing the image.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Design a conversation between you and a person asking about this photo. The answers should be in a tone that a visual AI assistant is seeing the image and answering the question.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Ask diverse questions and give corresponding answers.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Include questions asking about the visual content of the image, including the object types, counting the objects, object actions, object locations, relative positions between objects, etc. Only include questions that have definite answers:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">(1) one can see the content in the image that the question asks about and can answer confidently;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">(2) one can determine confidently from the image that it is not in the image.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Do not ask any question that cannot be answered confidently.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Also include complex questions that are relevant to the content in the image, for example, asking about background knowledge of the objects in the image, asking to discuss about events happening in the image, etc. Again, do not ask about uncertain details.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Provide detailed answers when answering complex questions. For example, give detailed examples or reasoning steps to make the content more convincing and well-organized.  You can include multiple paragraphs if necessary.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SAMPLE_CONTENT_1 <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">There is a movie theater that displays the show times above the doors.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">A red fire hydrant is deep in the snow.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">The fire hydrant is in the snow near a recently plowed sidewalk.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">This city has had a very hard winter with snow.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">A hotel for dogs in the snow in winter.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SAMPLE_RESPONSE_1 <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Question:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">What color is the fire hydrant in the image?
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Answer:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">The fire hydrant in the image is red.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Question:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Is the fire hydrant fully covered by snow or partially visible?
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Answer:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">The fire hydrant is partially visible, with a significant portion of it covered by the deep snow.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Question:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">What is the condition of the sidewalk near the fire hydrant?
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Answer:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">The sidewalk near the fire hydrant has been recently plowed, so it is relatively clear of snow compared to the surrounding area.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Question:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">What does the image suggest about the winter season in the city?
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Answer:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">The image suggests that the winter season in the city has been quite harsh and challenging. The significant snow accumulation seen in the image indicates that the city has experienced heavy snowfall, which can lead to various difficulties and disruptions for its residents. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">For instance, the deep snow covering the fire hydrant could potentially hinder its accessibility in case of emergencies, which poses safety concerns. The recently plowed sidewalk implies that the city&#39;s maintenance crews have been actively working to keep the walkways clear and safe for pedestrians, but the sheer amount of snowfall might make it difficult to keep up with the continuous snow removal efforts. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Furthermore, such extreme winter conditions can impact transportation, leading to traffic issues, delays in public transit, and increased risks of accidents due to slippery roads. It can also cause problems for businesses and schools, as people might face challenges commuting to work or attending classes. Additionally, the heavy snow can put extra strain on infrastructure, such as roofs and power lines, increasing the likelihood of structural damage or power outages. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">In conclusion, the image of the red fire hydrant deep in the snow and the recently plowed sidewalk suggest that the city has faced a particularly severe winter season, with substantial snowfall that has likely caused various challenges and disruptions for its residents and infrastructure.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SAMPLE_CONTENT_2 <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">A man is skiing in the open snow covered hills
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">A skier is making his way into the snow.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">A skier on the foothills of a huge mountain range.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">A skier looks at mountains while standing near a trail sign.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">a single person skiing by an area with a lot of bushes
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SAMPLE_RESPONSE_2 <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Question:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">What is the skier doing?
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Answer:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">The skier is skiing in the snow-covered hills, making his way through the snow and enjoying the beautiful mountain scenery. They are also standing near a trail sign, which indicates their location on the mountain.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Question:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Are there any other people or skiers visible in the image?
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Answer:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">No, there is only a single person skiing in the image, and they are surrounded by an area with a lot of bushes.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Question:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">What kind of skiing is the person doing? Cross-country or downhill?
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Answer:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Based on what I can see in the photo, it is not possible to definitively determine whether the skier is doing cross-country or downhill skiing. However, given the presence of a trail sign and the fact that they are skiing in the foothills, it is more likely that the skier is engaged in cross-country skiing. Downhill skiing typically takes place on more steep slopes and involves ski lifts, whereas cross-country skiing often occurs on relatively flatter terrain with marked trails.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Question:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Can you explain cross-country and downhill skiing a bit more?
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">===
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Answer:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Cross-country skiing and downhill skiing are two distinct types of skiing, each with its own techniques, equipment, and terrain preferences. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">1. Cross-Country Skiing:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Also known as Nordic skiing, cross-country skiing involves traversing relatively flat terrain or gentle slopes using skis and poles. It is a popular recreational and competitive sport that focuses on endurance, balance, and aerobic fitness. Cross-country skiers use their own locomotion to move across snow-covered terrain, rather than relying on ski lifts or other forms of assistance. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">There are two main techniques in cross-country skiing:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">- Classic: This technique involves skiing in parallel tracks, using a forward-and-backward gliding motion while keeping the skis parallel to each other. The skier uses their poles to propel themselves forward.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">- Skate skiing: This technique is similar to ice skating, where the skier pushes off one ski at an angle and glides on the other. It requires a smooth, groomed surface and is typically faster than the classic technique. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Cross-country ski equipment consists of lightweight skis, boots, bindings, and poles. The boots are more flexible than those used in downhill skiing, allowing for better ankle movement and control. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">2. Downhill Skiing:
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Also known as alpine skiing, downhill skiing involves descending slopes at high speeds using skis and poles for balance and control. This sport is more focused on speed, technique, and navigating challenging terrain, including steep slopes, moguls, and even jumps. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Downhill skiing can be further categorized into several disciplines, such as slalom, giant slalom, super-G, and downhill racing. Each discipline has its own set of rules, courses, and ski equipment. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Downhill ski equipment includes heavier and stiffer skis, boots, bindings, and poles than those used in cross-country skiing. The boots are more rigid to provide better support and control during high-speed descents and sharp turns. 
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">In summary, cross-country skiing is an endurance-based sport that involves traveling across flat or gently sloping terrain, while downhill skiing is focused on speed and technique as skiers navigate steeper slopes and challenging terrain. Both sports require specialized equipment and techniques, but they offer different experiences and challenges to participants.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>messages <span style="color:#5bc4bf">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#39;role&#39;</span>: <span style="color:#48b685">&#39;system&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#39;content&#39;</span>: SYSTEM_CONTENT,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fewshot_samples <span style="color:#5bc4bf">=</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#39;context&#39;</span>: SAMPLE_CONTENT_1,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#39;response&#39;</span>: SAMPLE_RESPONSE_1,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#39;context&#39;</span>: SAMPLE_CONTENT_2,
</span></span><span style="display:flex;"><span>        <span style="color:#48b685">&#39;response&#39;</span>: SAMPLE_RESPONSE_2,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#815ba4">for</span> sample <span style="color:#5bc4bf">in</span> fewshot_samples:
</span></span><span style="display:flex;"><span>    messages<span style="color:#5bc4bf">.</span>append({<span style="color:#48b685">&#39;role&#39;</span>: <span style="color:#48b685">&#39;user&#39;</span>, <span style="color:#48b685">&#39;content&#39;</span>: sample[<span style="color:#48b685">&#39;context&#39;</span>]})
</span></span><span style="display:flex;"><span>    messages<span style="color:#5bc4bf">.</span>append({<span style="color:#48b685">&#39;role&#39;</span>: <span style="color:#48b685">&#39;assistant&#39;</span>, <span style="color:#48b685">&#39;content&#39;</span>: sample[<span style="color:#48b685">&#39;response&#39;</span>]})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>query <span style="color:#5bc4bf">=</span> <span style="color:#48b685">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">A group of people standing outside of a black vehicle with various luggage.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Luggage surrounds a vehicle in an underground parking area
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">People try to fit all of their luggage in an SUV.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">The sport utility vehicle is parked in the public garage, being packed for a trip
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">Some people with luggage near a van that is transporting it.
</span></span></span><span style="display:flex;"><span><span style="color:#48b685">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>messages<span style="color:#5bc4bf">.</span>append({<span style="color:#48b685">&#34;role&#34;</span>:<span style="color:#48b685">&#34;user&#34;</span>, <span style="color:#48b685">&#34;content&#34;</span>: query})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>response <span style="color:#5bc4bf">=</span> client<span style="color:#5bc4bf">.</span>chat<span style="color:#5bc4bf">.</span>completions<span style="color:#5bc4bf">.</span>create(model<span style="color:#5bc4bf">=</span>model, messages<span style="color:#5bc4bf">=</span>messages)<span style="color:#5bc4bf">.</span>choices[<span style="color:#f99b15">0</span>]<span style="color:#5bc4bf">.</span>message<span style="color:#5bc4bf">.</span>content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(response)
</span></span></code></pre></div><p>使用Llama3-8B-Instruct生成的问答数据如下所示：</p>
<pre tabindex="0"><code>Question:
What type of vehicle is being packed with luggage?
===
Answer:
The vehicles being packed with luggage are a black SUV (sport utility vehicle) and a van.
===
Question:
Where is the luggage being packed into the vehicle(s)?
===
Answer:
The luggage is being packed into the vehicles in an underground parking area, as well as in a public garage.
===
Question:
How many people are trying to fit their luggage into the vehicle?
===
Answer:
It appears that there is a group of people trying to fit their luggage into the SUV, but the exact number is not clear from the image.
===
Question:
What is the purpose of the people packing their luggage into the vehicle(s)?
===
Answer:
Based on the context of the image, it appears that the people are packing their luggage into the vehicles in preparation for a trip. The luggage and the vehicles suggest that they are likely going on a vacation or a long journey, and the underground parking area and public garage suggest that they are preparing to leave from a city or urban area.
===
Question:
Can you explain the importance of underground parking and public garages in urban areas?
===
Answer:
Yes, certainly! Underground parking and public garages play a crucial role in urban areas, especially in cities with limited street parking and high population density. These structures provide a convenient and secure way for residents and visitors to park their vehicles, reducing the need for on-street parking and minimizing the visual impact of parked cars on the urban landscape.

Underground parking garages, in particular, offer a range of benefits, including:
* Protection from the elements: Cars are shielded from inclement weather, reducing the risk of damage and making it easier to maintain the vehicles.
* Security: Underground parking garages often have controlled access, surveillance cameras, and secure entry/exit points, providing a safer environment for parked vehicles and their occupants.
* Convenience: Underground parking garages are often located near public transportation hubs, commercial centers, and residential areas, making it easier for people to park and access their destinations.
* Urban planning: Underground parking garages can help to reduce the visual impact of parking on urban streets, freeing up surface areas for other uses and helping to create more pedestrian-friendly and aesthetically pleasing public spaces.

In the context of the image, the underground parking area and public garage suggest that the people are preparing to leave from a city or urban area, and the presence of luggage and vehicles confirms that they are embarking on a trip.
</code></pre><hr>
<h1 id="处理数据">处理数据<a hidden class="anchor" aria-hidden="true" href="#处理数据">#</a></h1>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://attract666.github.io/tags/vision-language-models/">Vision-Language-Models</a></li>
      <li><a href="https://attract666.github.io/tags/llava/">LLaVA</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://attract666.github.io/">JiaHe&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
